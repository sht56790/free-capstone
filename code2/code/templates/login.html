<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Proxy â€“ ë¡œê·¸ì¸</title>
  <style>
    :root{
      --bg:#ffffff; --panel:#ffffff; --muted:#f6f8fb; --ring:#e6eaf2;
      --text:#101828; --sub:#667085;
      --blue:#2563eb; --blue-2:#60a5fa; --mint:#10b981;
      --danger:#ef4444; --success:#16a34a; --shadow:0 10px 24px rgba(16,24,40,.06);
      --radius:16px; --radius-sm:12px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; color:var(--text); background:
        radial-gradient(800px 300px at 80% -80px, rgba(37,99,235,.08), transparent),
        radial-gradient(600px 240px at -100px -120px, rgba(16,185,129,.06), transparent),
        var(--bg);
      font:500 15px/1.55 "Pretendard","Inter","Noto Sans KR",system-ui;
    }
    .wrap{min-height:100%; display:grid; place-items:center; padding:32px}
    .card{
      width:100%; max-width:420px; background:var(--panel);
      border:1px solid var(--ring); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:22px;
    }
    .brand{display:flex; align-items:center; gap:10px; margin-bottom:14px}
    .logo{width:36px;height:36px;border-radius:12px;
      background:conic-gradient(from 180deg,var(--blue),var(--mint),var(--blue));
      box-shadow:0 0 0 4px rgba(59,130,246,.10)}
    .brand h1{font-size:18px; margin:0}
    .title{margin:6px 0 2px; font-weight:800; font-size:24px; letter-spacing:-.2px}
    .sub{color:var(--sub); margin:0 0 16px}

    .field{margin:12px 0}
    .label{display:flex; justify-content:space-between; font-size:13px; color:#475467; margin-bottom:6px}
    .input{
      width:100%; border:1px solid var(--ring); background:#fff; color:var(--text);
      border-radius:12px; padding:12px 12px; outline:none; box-shadow:var(--shadow)
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 2px}
    .checkbox{display:flex; align-items:center; gap:8px; font-size:13px; color:#475467}
    .btn{
      width:100%; border:1px solid #c7d7fe; background:linear-gradient(180deg,rgba(37,99,235,.12),rgba(37,99,235,.04));
      color:var(--text); border-radius:12px; padding:12px 14px; cursor:pointer; box-shadow:var(--shadow); font-weight:600
    }
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .muted{color:#98a2b3; font-size:12px; text-align:center; margin-top:12px}
    .error{color:var(--danger); font-size:13px; margin:8px 0 0}
    .divider{display:flex; align-items:center; gap:10px; margin:12px 0}
    .divider::before,.divider::after{content:""; flex:1; height:1px; background:var(--ring)}
    .outline{
      width:100%; background:#fff; border:1px solid var(--ring); border-radius:12px; padding:10px 12px;
      display:flex; align-items:center; gap:8px; cursor:pointer
    }
    .eye{position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; color:#667085}
    .passbox{position:relative}
    a{color:var(--blue); text-decoration:none}
    .top-links{position:fixed; right:18px; top:18px; display:flex; gap:8px}
    .pill{padding:6px 10px; border:1px dashed var(--ring); border-radius:999px; font-size:12px; color:#98a2b3; background:#fff}
  </style>
</head>
<body>
  <div class="top-links">
    <span class="pill">í”„ë¡ì‹œ ì—°ê²° í•„ìš”</span>
  </div>

  <main class="wrap">
    <section class="card" role="dialog" aria-labelledby="title">
      <div class="brand"><div class="logo"></div><h1>Chat Proxy</h1></div>
      <h2 id="title" class="title">ë¡œê·¸ì¸</h2>
      <p class="sub">íŒ€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”. ë¯¼ê°ì •ë³´ëŠ” ì „ì†¡ ì „ì— í”„ë¡ì‹œì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>

      <form id="form" novalidate>
        <div class="field">
          <div class="label"><label for="email">ì´ë©”ì¼</label></div>
          <input id="email" class="input" type="email" placeholder="you@company.com" autocomplete="username" required />
        </div>

        <div class="field passbox">
          <div class="label">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <a href="#" onclick="alert('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.');return false;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
          </div>
          <input id="password" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" required />
          <span class="eye" id="togglePw" aria-label="ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸°" title="í‘œì‹œ/ìˆ¨ê¸°ê¸°">ğŸ‘ï¸</span>
        </div>

        <div class="row">
          <label class="checkbox"><input id="remember" type="checkbox" /> ë¡œê·¸ì¸ ìœ ì§€</label>
          <span></span>
        </div>

        <button class="btn" id="submitBtn" type="submit">ë¡œê·¸ì¸</button>
        <p id="error" class="error" style="display:none"></p>

        <div class="divider"><span class="muted">ë˜ëŠ”</span></div>
        <button type="button" class="outline" onclick="demoLogin()">
          <span>ğŸ”“</span> ê²ŒìŠ¤íŠ¸ë¡œ ë‘˜ëŸ¬ë³´ê¸°
        </button>

        <p class="muted">ë¡œê·¸ì¸í•˜ë©´ <a href="#" onclick="alert('ì•½ê´€ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.');return false;">ì„œë¹„ìŠ¤ ì•½ê´€</a> ë° <a href="#" onclick="alert('ì •ì±…ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.');return false;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
      </form>
    </section>
  </main>

  <script>
    // ===== ì„¤ì • =====
    // í”„ë¡ì‹œ ë°±ì—”ë“œ ì£¼ì†Œ (ë‹¹ì‹  í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •)
    const LOGIN_ENDPOINT = '/login'; // 
    const HEALTH_ENDPOINT = '/health'; // 
    
    // ===== UI ë¡œì§ =====
    const form = document.getElementById('form');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const remember = document.getElementById('remember');
    const submitBtn = document.getElementById('submitBtn');
    const errorEl = document.getElementById('error');
    const togglePw = document.getElementById('togglePw');

    // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸°
    togglePw.addEventListener('click', ()=>{
      password.type = password.type === 'password' ? 'text' : 'password';
    });

    // ì„œë²„ ìƒíƒœ í‘œì‹œ (ìƒë‹¨ pill í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸)
    fetch(HEALTH_ENDPOINT, {cache:'no-store'}).then(r=>r.ok).catch(()=>false);

    // í¼ ì œì¶œ
    form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorEl.style.display = 'none';
    const emailVal = email.value.trim();
    const pwVal = password.value;

    if (!emailVal || !pwVal) {
        showError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'í™•ì¸ ì¤‘â€¦';
    
    try {
        const res = await fetch(LOGIN_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: emailVal, password: pwVal })
        });
        const data = await res.json();
        if (!res.ok) {
            throw new Error(data.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
        }

        // 1. ì—­í• ì„ ë¸Œë¼ìš°ì €ì— ì €ì¥í•©ë‹ˆë‹¤.
        localStorage.setItem('userRole', data.role);

        // 2. ì—­í• ì— ë”°ë¼ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
        if (data.role === 'admin') {
          window.location.href = '/admin'; // ê´€ë¦¬ìëŠ” /admin ìœ¼ë¡œ
        } else {
          window.location.href = '/chat';  // ì¼ë°˜ ì‚¬ìš©ìëŠ” /chat ìœ¼ë¡œ
        }
    } catch (err) {
        showError(err.message || 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ë¡œê·¸ì¸';
    }
    });

    function showError(msg){
      errorEl.textContent = msg;
      errorEl.style.display = 'block';
    }
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

    // Enter í‚¤ë¡œ ì œì¶œ
    [email,password].forEach(i=>i.addEventListener('keydown',e=>{
      if(e.key==='Enter') form.requestSubmit();
    }));
    // ê²ŒìŠ¤íŠ¸ ë¡œê·¸ì¸
    function demoLogin() {
      localStorage.setItem('userRole', 'guest');
      location.href = 'Chat%20Proxy.html';
    }
  </script>
</body>
</html>