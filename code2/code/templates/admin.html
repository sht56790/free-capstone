<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Proxy â€“ ê´€ë¦¬ì í˜ì´ì§€</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* -------------------
     * ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ë””ìì¸ ì‹œìŠ¤í…œ (ì‚¬ìš©ì í™”ë©´ê³¼ ë™ì¼)
     * ------------------- */
    :root {
      --bg: #f8fafc; --panel: #ffffff; --muted: #f1f5f9; --ring: #e2e8f0;
      --text: #1e293b; --sub: #64748b;
      --blue: #2563eb; --blue-2: #60a5fa; --mint: #10b981;
      --danger: #ef4444; --success: #16a34a; --warn: #f59e0b;
      --shadow: 0 4px 12px rgba(30, 41, 59, .06);
      --radius: 12px; --radius-sm: 8px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; color: var(--text); background: var(--bg);
      font: 500 15px/1.55 "Pretendard", "Inter", "Noto Sans KR", system-ui;
      -webkit-font-smoothing: antialiased;
    }
    .layout { display: grid; grid-template-columns: 260px 1fr; height: 100vh; }

    /* -------------------
     * ì‚¬ì´ë“œë°” (ë„¤ë¹„ê²Œì´ì…˜)
     * ------------------- */
    .sidebar {
      background: var(--panel); border-right: 1px solid var(--ring);
      padding: 16px; display: flex; flex-direction: column;
    }
    .brand { display: flex; align-items: center; gap: 10px; margin-bottom: 24px; }
    .logo {
      width: 32px; height: 32px; border-radius: 10px;
      background: conic-gradient(from 180deg, var(--blue), var(--mint), var(--blue));
      box-shadow: 0 0 0 4px rgba(59, 130, 246, .12);
    }
    .brand h1 { font-size: 18px; margin: 0; }
    .nav-group-title { font-size: 12px; color: #94a3b8; margin: 20px 8px 8px; }
    .nav-link {
      display: flex; align-items: center; gap: 10px; padding: 10px 12px;
      border-radius: var(--radius-sm); text-decoration: none; color: var(--sub);
      border: 1px solid transparent; transition: all .2s;
    }
    .nav-link:hover { background: var(--muted); color: var(--text); }
    .nav-link.active {
      background: #eef2ff; color: var(--blue); font-weight: 600;
      border-color: #c7d2fe;
    }
    .sidebar footer {
      margin-top: auto; font-size: 12px; color: #94a3b8; padding: 16px 0;
      border-top: 1px solid var(--ring);
    }
    .sidebar footer a { color: var(--blue); }

    /* -------------------
     * ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
     * ------------------- */
    .main { display: grid; grid-template-rows: auto 1fr; height: 100vh; overflow: hidden; }
    .topbar {
      display: flex; align-items: center; padding: 14px 24px;
      background: var(--panel); border-bottom: 1px solid var(--ring);
    }
    .topbar h2 { margin: 0; font-size: 20px; }
    .content-wrap { overflow-y: auto; padding: 24px; }

    /* ê³µìš© ì»´í¬ë„ŒíŠ¸ */
    .card { background: var(--panel); border-radius: var(--radius); border: 1px solid var(--ring); box-shadow: var(--shadow); padding: 20px; }
    .btn {
      padding: 10px 16px; border-radius: var(--radius-sm); border: 1px solid var(--ring);
      background: var(--panel); color: var(--text); cursor: pointer; font-weight: 600;
      box-shadow: var(--shadow); transition: all .2s;
    }
    .btn:hover { border-color: #94a3b8; }
    .btn.primary { background: var(--blue); color: #fff; border-color: var(--blue); }
    .btn.primary:hover { background: #1d4ed8; }
    .btn.danger { background: var(--danger); color: #fff; border-color: var(--danger); }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 14px; text-align: left; border-bottom: 1px solid var(--ring); font-size: 14px; }
    th { background: var(--muted); color: var(--sub); font-weight: 600; }
    tbody tr:hover { background: #fcfdff; }
    .tag {
      display: inline-block; padding: 4px 10px; border-radius: 999px;
      font-size: 12px; font-weight: 600;
    }
    .tag.mask { background: #ffedd5; color: #9a3412; }
    .tag.block { background: #fee2e2; color: #991b1b; }
    .tag.user { background: #e0e7ff; color: #3730a3; }
    .tag.admin { background: #dcfce7; color: #15803d; }

    .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
    .input {
      flex: 1; border: 1px solid var(--ring); background: #fff; padding: 10px 12px;
      border-radius: var(--radius-sm); outline-color: var(--blue);
    }

    /* -------------------
     * ë·°ë³„ ìŠ¤íƒ€ì¼
     * ------------------- */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .stat-card { background: var(--panel); border-radius: var(--radius); border: 1px solid var(--ring); padding: 20px; box-shadow: var(--shadow); }
    .stat-card .label { font-size: 14px; color: var(--sub); margin-bottom: 8px; }
    .stat-card .value { font-size: 32px; font-weight: 700; }
    .chart-card { margin-top: 24px; }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal-backdrop {
        position: fixed; inset: 0; background: rgba(30, 41, 59, .6);
        display: none; place-items: center; backdrop-filter: blur(4px);
    }
    .modal-content {
        background: var(--panel); padding: 24px; border-radius: var(--radius);
        width: 100%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,.2);
    }
    .modal-content h3 { margin: 0 0 20px; }
    .form-field { margin-bottom: 16px; }
    .form-field label { display: block; font-size: 13px; margin-bottom: 6px; }
    .form-field .input, .form-field select { width: 100%; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 24px; }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand"><div class="logo"></div><h1>Admin</h1></div>
      <nav>
        <a href="#" class="nav-link active" data-view="dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
        <a href="#" class="nav-link" data-view="logs">ğŸ›¡ï¸ ê°ì‚¬ ë¡œê·¸</a>
        
        <div class="nav-group-title">ê´€ë¦¬</div>
        <a href="#" class="nav-link" data-view="users">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</a>
        <a href="#" class="nav-link" data-view="rules">âš™ï¸ íƒì§€ ê·œì¹™ ê´€ë¦¬</a>
        <a href="#" class="nav-link" data-view="status">ğŸŒ ì‹œìŠ¤í…œ ìƒíƒœ</a>
      </nav>
      <footer>
        Chat Proxy Capstone. <br/>
        <a href="#" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>
      </footer>
    </aside>

    <main class="main">
      <div class="topbar">
        <h2 id="view-title">ëŒ€ì‹œë³´ë“œ</h2>
      </div>

      <div class="content-wrap">
        <section id="dashboard-view">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="label">ì˜¤ëŠ˜ì˜ ìš”ì²­</div>
              <div class="value" id="stat-today-requests">1,402</div>
            </div>
            <div class="stat-card">
              <div class="label">íƒì§€ëœ ë¯¼ê°ì •ë³´ (24h)</div>
              <div class="value" id="stat-pii-detected">88</div>
            </div>
            <div class="stat-card">
              <div class="label">ì°¨ë‹¨ëœ ìš”ì²­ (24h)</div>
              <div class="value" id="stat-blocked">12</div>
            </div>
             <div class="stat-card">
              <div class="label">í™œì„± ì‚¬ìš©ì</div>
              <div class="value" id="stat-active-users">15</div>
            </div>
          </div>

          <div class="chart-card card">
            <h3>ìµœê·¼ 7ì¼ ìš”ì²­/íƒì§€ ì¶”ì´</h3>
            <canvas id="trends-chart"></canvas>
          </div>
          <div class="chart-card card">
            <h3>íƒì§€ ìœ í˜• ë¶„í¬</h3>
            <canvas id="pii-chart"></canvas>
          </div>
        </section>

        <section id="logs-view" style="display: none;">
          <div class="card">
              <div class="input-group">
                  <input type="text" id="log-search" class="input" placeholder="ì‚¬ìš©ì ID ë˜ëŠ” í‚¤ì›Œë“œë¡œ ê²€ìƒ‰...">
                  <input type="date" id="log-date" class="input">
                  <select id="log-type" class="input">
                      <option value="">ëª¨ë“  íƒì§€ ìœ í˜•</option>
                      <option value="PHONE">ì „í™”ë²ˆí˜¸</option>
                      <option value="EMAIL">ì´ë©”ì¼</option>
                      <option value="CARD">ì¹´ë“œë²ˆí˜¸</option>
                  </select>
              </div>
              <table>
                <thead>
                  <tr><th>ì‹œê°„</th><th>ì‚¬ìš©ì</th><th>íƒì§€ ë‚´ì—­</th><th>ì²˜ë¦¬</th><th>ìš”ì²­ ë‚´ìš©</th></tr>
                </thead>
                <tbody id="log-table-body">
                  </tbody>
              </table>
          </div>
        </section>

        <section id="users-view" style="display: none;">
            <div class="card">
                <button class="btn primary" id="add-user-btn" style="margin-bottom: 20px;">ï¼‹ ìƒˆ ì‚¬ìš©ì ì¶”ê°€</button>
                <table>
                    <thead>
                        <tr><th>ì‚¬ìš©ì ID (ì´ë©”ì¼)</th><th>ì—­í• </th><th>ë§ˆì§€ë§‰ ì ‘ì†</th><th>ê´€ë¦¬</th></tr>
                    </thead>
                    <tbody id="user-table-body">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="rules-view" style="display: none;">
            <div class="card">
                <button class="btn primary" id="add-rule-btn" style="margin-bottom: 20px;">ï¼‹ ìƒˆ ê·œì¹™ ì¶”ê°€</button>
                <table>
                    <thead>
                        <tr><th>ê·œì¹™ ì´ë¦„</th><th>ì²˜ë¦¬ ë°©ì‹</th><th>ì •ê·œì‹ (Regex)</th><th>í™œì„± ìƒíƒœ</th><th>ê´€ë¦¬</th></tr>
                    </thead>
                    <tbody id="rule-table-body">
                       </tbody>
                </table>
            </div>
        </section>

        <section id="status-view" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                  <div class="label">í”„ë¡ì‹œ ì„œë²„ ìƒíƒœ</div>
                  <div class="value" style="color: var(--success);">ì •ìƒ</div>
                </div>
                <div class="stat-card">
                  <div class="label">Gemini API ì—°ê²°</div>
                  <div class="value" style="color: var(--success);">ì—°ê²°ë¨</div>
                </div>
                 <div class="stat-card">
                  <div class="label">DB ì—°ê²° ìƒíƒœ</div>
                  <div class="value" style="color: var(--warn);">ì—°ê²° ì•ˆ ë¨ (Demo)</div>
                </div>
            </div>
        </section>
      </div>
    </main>
  </div>

  <div class="modal-backdrop" id="user-modal">
      <div class="modal-content">
          <h3 id="user-modal-title">ìƒˆ ì‚¬ìš©ì ì¶”ê°€</h3>
          <form id="user-form">
              <input type="hidden" id="user-id-hidden">
              <div class="form-field">
                  <label for="user-email">ì‚¬ìš©ì ID (ì´ë©”ì¼)</label>
                  <input type="email" id="user-email" class="input" required>
              </div>
              <div class="form-field">
                  <label for="user-password">ë¹„ë°€ë²ˆí˜¸ (ìƒˆë¡œ ì„¤ì • ì‹œì—ë§Œ ì…ë ¥)</label>
                  <input type="password" id="user-password" class="input">
              </div>
              <div class="form-field">
                  <label for="user-role">ì—­í• </label>
                  <select id="user-role" class="input">
                      <option value="user">User</option>
                      <option value="admin">Admin</option>
                  </select>
              </div>
              <div class="modal-actions">
                  <button type="button" class="btn" id="user-modal-close">ì·¨ì†Œ</button>
                  <button type="submit" class="btn primary">ì €ì¥</button>
              </div>
          </form>
      </div>
  </div>

  <div class="modal-backdrop" id="rule-modal">
      <div class="modal-content">
          <h3 id="rule-modal-title">ìƒˆ ê·œì¹™ ì¶”ê°€</h3>
          <form id="rule-form">
              <input type="hidden" id="rule-id-hidden">
              <div class="form-field">
                  <label for="rule-name">ê·œì¹™ ì´ë¦„</label>
                  <input type="text" id="rule-name" class="input" required placeholder="ì˜ˆ: ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸">
              </div>
              <div class="form-field">
                  <label for="rule-action">ì²˜ë¦¬ ë°©ì‹</label>
                  <select id="rule-action" class="input">
                      <option value="mask">ë§ˆìŠ¤í‚¹ (Mask)</option>
                      <option value="block">ì°¨ë‹¨ (Block)</option>
                  </select>
              </div>
              <div class="form-field">
                  <label for="rule-regex">ì •ê·œì‹ (Regex)</label>
                  <input type="text" id="rule-regex" class="input" required placeholder="\d{6}-?[1-4]\d{6}">
              </div>
               <div class="form-field">
                  <label for="rule-status">ìƒíƒœ</label>
                  <select id="rule-status" class="input">
                      <option value="active">í™œì„±</option>
                      <option value="inactive">ë¹„í™œì„±</option>
                  </select>
              </div>
              <div class="modal-actions">
                  <button type="button" class="btn" id="rule-modal-close">ì·¨ì†Œ</button>
                  <button type="submit" class="btn primary">ì €ì¥</button>
              </div>
          </form>
      </div>
  </div>


<script>
    // API ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
    const API_BASE = '/api/admin';

    document.addEventListener('DOMContentLoaded', () => {
      // --- DOM ìš”ì†Œ ìºì‹± ---
      const viewTitle = document.getElementById('view-title');
      const views = document.querySelectorAll('main .content-wrap > section');
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          // ë§í¬ë¥¼ í´ë¦­í–ˆì„ ë•Œ í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë˜ëŠ” ê²ƒì„ ë§‰ìŒ
          e.preventDefault(); 
          // showView í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ í™”ë©´ì„ ì „í™˜í•¨
          showView(link.dataset.view);
        });
      });

      const logTableBody = document.getElementById('log-table-body');
      
      // [ì‹ ê·œ] í•„í„° ì…ë ¥ ìš”ì†Œ ìºì‹±
      const logSearchInput = document.getElementById('log-search');
      const logDateInput = document.getElementById('log-date');
      const logTypeSelect = document.getElementById('log-type');
      
      // --- ê°€ìƒ ë°ì´í„° (ê·œì¹™ì€ ì•„ì§ ìœ ì§€, ë¡œê·¸ëŠ” ì‚­ì œ) ---
      const DUMMY_RULES = [ /* ... ê¸°ì¡´ ê·œì¹™ ë°ì´í„° ... */ ];
      let allLogs = []; // [ì‹ ê·œ] ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ëª¨ë“  ë¡œê·¸ë¥¼ ì €ì¥í•  ë³€ìˆ˜

      // --- ë·° ì „í™˜ ë¡œì§ ---
      const showView = (viewId) => {
      // 1. ëª¨ë“  ë·°(<section>)ë¥¼ ì¼ë‹¨ ìˆ¨ê¹ë‹ˆë‹¤.
      views.forEach(view => view.style.display = 'none');

      // 2. í´ë¦­ëœ ë©”ë‰´ì— í•´ë‹¹í•˜ëŠ” ë·°ë§Œ í™”ë©´ì— ë³´ì—¬ì¤ë‹ˆë‹¤.
      const activeView = document.getElementById(viewId + '-view');
      if (activeView) activeView.style.display = 'block';

      // 3. í´ë¦­ëœ ë©”ë‰´ì—ë§Œ 'active' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì„œ íŒŒë€ìƒ‰ìœ¼ë¡œ ê°•ì¡°í•©ë‹ˆë‹¤.
      navLinks.forEach(link => {
        link.classList.toggle('active', link.dataset.view === viewId);
      });

      // 4. í˜ì´ì§€ ìƒë‹¨ ì œëª©ì„ í˜„ì¬ ë·°ì˜ ì´ë¦„ìœ¼ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
      const linkText = document.querySelector(`.nav-link[data-view="${viewId}"]`).textContent;
      viewTitle.textContent = linkText.substring(2); // ë©”ë‰´ ì´ë¦„ ì•ì˜ ì´ëª¨ì§€ë¥¼ ì œê±°í•˜ê³  ì œëª©ìœ¼ë¡œ ì„¤ì •
      };

      // ë¡œê·¸ ë Œë”ë§ í•¨ìˆ˜: í•„í„°ë§ ê¸°ëŠ¥ ì¶”ê°€
      const renderLogs = (filters = {}) => {
          const filteredLogs = allLogs.filter(log => {
              const matchesUser = !filters.user || (log.user && log.user.includes(filters.user));
              const matchesDate = !filters.date || (log.ts && log.ts.startsWith(filters.date));
              const matchesType = !filters.type || (log.pii && log.pii.includes(filters.type));
              return matchesUser && matchesDate && matchesType;
          });

          logTableBody.innerHTML = '';
          filteredLogs.forEach(log => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                  <td>${log.ts || 'N/A'}</td>
                  <td>${log.user || 'N/A'}</td>

                  <td>${log.pii && log.pii.length ? log.pii.join(', ') : '-'}</td>
                  <td><span class="tag ${log.action || 'default'}">${(log.action || 'N/A').toUpperCase()}</span></td>
                  <td>${(log.user_prompt || '').substring(0, 30)}...</td>
              `;
              logTableBody.appendChild(tr);
          });
      };

      // [ì‹ ê·œ] ì„œë²„ì—ì„œ ì‹¤ì œ ë¡œê·¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
      const fetchLogs = async () => {
          try {
              const response = await fetch(`${API_BASE}/logs`);
              if (!response.ok) throw new Error('ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              allLogs = await response.json(); // ë°›ì•„ì˜¨ ë¡œê·¸ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
              
              // ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹ ìˆœ ì •ë ¬
              allLogs.sort((a, b) => new Date(b.ts) - new Date(a.ts));
              
              renderLogs(); // í•„í„° ì—†ì´ ì „ì²´ ë¡œê·¸ë¥¼ ë Œë”ë§
          } catch (error) {
              console.error(error);
              logTableBody.innerHTML = `<tr><td colspan="5" style="color:var(--danger);">${error.message}</td></tr>`;
          }
      };
      
      const renderRules = () => { /* ... ê¸°ì¡´ê³¼ ë™ì¼ ... */ };
      const fetchUsersAndRender = async () => { /* ... ì´ì „ ë‹¨ê³„ì—ì„œ ë§Œë“  í•¨ìˆ˜ ... */ };

      // --- ëŒ€ì‹œë³´ë“œ ì°¨íŠ¸ (ê¸°ì¡´ê³¼ ë™ì¼) ---
      const piiCtx = document.getElementById('pii-chart').getContext('2d');
      // ... ì°¨íŠ¸ ì½”ë“œ ...
      
      // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
      navLinks.forEach(link => { /* ... */ });
      // ... ëª¨ë‹¬ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ...

      // [ì‹ ê·œ] ë¡œê·¸ í•„í„°ë§ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      logSearchInput.addEventListener('keyup', () => applyLogFilters());
      logDateInput.addEventListener('change', () => applyLogFilters());
      logTypeSelect.addEventListener('change', () => applyLogFilters());

      const applyLogFilters = () => {
          const filters = {
              user: logSearchInput.value,
              date: logDateInput.value,
              type: logTypeSelect.value,
          };
          renderLogs(filters);
      };

      // [ì‹ ê·œ] ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ê°€ì ¸ì™€ì„œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    const fetchDashboardStats = async () => {
        try {
            const response = await fetch(`${API_BASE}/dashboard-stats`);
            if (!response.ok) return;
        
            const stats = await response.json();
            document.getElementById('stat-today-requests').textContent = stats.today_requests;
            document.getElementById('stat-pii-detected').textContent = stats.pii_detected;
            document.getElementById('stat-blocked').textContent = stats.blocked;
            document.getElementById('stat-active-users').textContent = stats.active_users;
        } catch (error) {
            console.error("Dashboard stats error:", error);
        }
    };

      // --- ì´ˆê¸°í™” ---
      const init = () => {
          fetchLogs(); // [ìˆ˜ì •ë¨] ê°€ìƒ ë°ì´í„° ëŒ€ì‹  ì‹¤ì œ ë¡œê·¸ fetch
          fetchLogs();
          fetchUsersAndRender();
          renderRules();
          fetchDashboardStats();
          renderTrendsChart();
          setInterval(fetchDashboardStats, 5000);
          showView('dashboard');
      };
      
      init();
    });

    let trendsChartInstance = null;
    let piiChartInstance = null;

    // --- ëŒ€ì‹œë³´ë“œ ì°¨íŠ¸ ---
    function renderPiiChart() {
      if (piiChartInstance) {
          piiChartInstance.destroy();
      }
      const piiCtx = document.getElementById('pii-chart').getContext('2d');
      piiChartInstance = new Chart(piiCtx, {
        type: 'pie',
        data: {
          labels: ['ì „í™”ë²ˆí˜¸', 'ì´ë©”ì¼', 'ì¹´ë“œë²ˆí˜¸', 'ì£¼ë¯¼ë²ˆí˜¸'], // ì´ ë°ì´í„°ë„ ë‚˜ì¤‘ì— APIë¡œ ë°›ì•„ì˜¤ë©´ ì¢‹ìŠµë‹ˆë‹¤.
          datasets: [{
            label: 'íƒì§€ ê±´ìˆ˜',
            data: [45, 25, 15, 3],
            backgroundColor: ['#60a5fa', '#34d399', '#f87171', '#facc15'],
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
  }
    // êº¾ì€ì„  ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
    const renderTrendsChart = async () => {
      debugger;
    console.log("ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ ì‹œì‘. í˜„ì¬ trendsChartInstance:", trendsChartInstance);
        try {
            const response = await fetch(`${API_BASE}/trends`);
            if (!response.ok) return;
        
            const trendsData = await response.json();
        
            if (trendsChartInstance) {
                trendsChartInstance.destroy();
            }

            const trendsCtx = document.getElementById('trends-chart').getContext('2d');
        
            trendsChartInstance = new Chart(trendsCtx, {
                type: 'line',
                data: trendsData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
        } catch (error) {
            console.error("Trends chart error:", error);
        }
    };
</script>
</body>
</html>